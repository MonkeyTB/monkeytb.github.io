I"§<p>layout:post
title:code
description:å¹³æ—¶é‡åˆ°çš„ä¸€äº›ä»£ç ï¼Œæ–¹ä¾¿æŸ¥æ‰¾
tag:code
â€”</p>

<h2 id="ä¸¤ä¸ªlistå…³è”æ’åº">ä¸¤ä¸ªlistå…³è”æ’åº</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># æ‰“åŒ…
</span><span class="n">zipped</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sen</span><span class="p">,</span><span class="n">count</span><span class="p">)</span>
<span class="c1"># æ’åº
</span><span class="n">sort_zipped</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">zipped</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1"># è¿˜åŸ
</span><span class="n">result</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">sort_zipped</span><span class="p">)</span>
<span class="n">sen</span><span class="p">,</span><span class="n">count</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>
</code></pre></div></div>

<h2 id="pandas-è¡Œåˆ—æ˜¾ç¤ºä¸å…¨è§£å†³æ–¹å¼">pandas è¡Œåˆ—æ˜¾ç¤ºä¸å…¨è§£å†³æ–¹å¼</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#æ˜¾ç¤ºæ‰€æœ‰åˆ—
</span><span class="n">pd</span><span class="p">.</span><span class="n">set_option</span><span class="p">(</span><span class="s">'display.max_columns'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="c1">#æ˜¾ç¤ºæ‰€æœ‰è¡Œ
</span><span class="n">pd</span><span class="p">.</span><span class="n">set_option</span><span class="p">(</span><span class="s">'display.max_rows'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="c1">#è®¾ç½®valueçš„æ˜¾ç¤ºé•¿åº¦ä¸º100ï¼Œé»˜è®¤ä¸º50
</span><span class="n">pd</span><span class="p">.</span><span class="n">set_option</span><span class="p">(</span><span class="s">'max_colwidth'</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="git">git</h2>

<pre><code class="language-reStructuredText"># æ’¤å›ä¸Šä¸€æ¬¡çš„commit
git reset --soft HEAD^
# åˆ é™¤è¿œç¨‹åˆ†æ”¯
git push origin --delete branch-zlf
# åˆ é™¤æœ¬åœ°åˆ†æ”¯
git branch -d branch-zlf
# åˆ›å»ºåˆ†æ”¯
git branch branch-zlf
# åˆ‡æ¢åˆ†æ”¯
git checkout branch-zlf
</code></pre>

<h2 id="tensor-flow-addons-ç‰ˆæœ¬é—®é¢˜">Tensor Flow Addons ç‰ˆæœ¬é—®é¢˜</h2>

<table>
  <tbody>
    <tr>
      <td>Tensor Flow Addons</td>
      <td>TensorFlow</td>
      <td>Python</td>
    </tr>
    <tr>
      <td>tfa-nightly</td>
      <td>2.2</td>
      <td>3.5,3.6,3.7,3.8</td>
    </tr>
    <tr>
      <td>twnsorflow-addons-0.10.0</td>
      <td>2.2</td>
      <td>3.5,3.6,3.7,3.8</td>
    </tr>
    <tr>
      <td>tensorflow-addons-0.9.1</td>
      <td>2.1,2.2</td>
      <td>3.5,3.6,3.7</td>
    </tr>
    <tr>
      <td>tensorflow-addons-0.8.3</td>
      <td>2.1</td>
      <td>3.5,3.6,3.7</td>
    </tr>
    <tr>
      <td>tensorflow-addons-0.7.1</td>
      <td>2.1</td>
      <td>2.7,3.5,3.6,3.7</td>
    </tr>
    <tr>
      <td>tensorflow-addons-0.6.0</td>
      <td>2.0</td>
      <td>2.7,3.5,3.6,3.7</td>
    </tr>
  </tbody>
</table>

<h2 id="pandas-åˆ é™¤nanå€¼">pandas åˆ é™¤Nanå€¼</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dataframe è¡Œè‡³å°‘æœ‰ä¸¤ä¸ªä¸ä¸º Nan ä¿ç•™,inplace True åŸdataframeä¸Šè¿›è¡Œæ“ä½œ
</span><span class="n">df_mark</span><span class="p">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span> <span class="o">=</span> <span class="s">'all'</span><span class="p">,</span><span class="n">thresh</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1"># dataframe è¡Œå…¨ä¸º Nan åˆ é™¤
</span><span class="n">df_mark</span><span class="p">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span> <span class="o">=</span> <span class="s">'all'</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1"># dataframe è¡Œæœ‰ä¸€ä¸ª Nan åˆ é™¤
</span><span class="n">df_mark</span><span class="p">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span> <span class="o">=</span> <span class="s">'any'</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="å­—ç¬¦ä¸²æŸ¥æ‰¾é¦–æ¬¡å‡ºç°çš„ä½ç½®">å­—ç¬¦ä¸²æŸ¥æ‰¾é¦–æ¬¡å‡ºç°çš„ä½ç½®</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">re</span>
<span class="n">content</span> <span class="o">=</span> <span class="s">'1ã€ä¸­ä¸“ä»¥ä¸Šå­¦å†ï¼Œå†œä¸šç›¸å…³ä¸“ä¸šï¼Œä»äº‹å†œä¸šæŠ€æœ¯åº”ç”¨ä¸å®è·µå·¥ä½œä¸€å¹´ä»¥ä¸Šï¼› 2ã€çƒ­çˆ±å†œä¸šï¼Œä¸ºäººè¸å®ç¨³é‡ï¼Œèƒ½åƒè‹¦è€åŠ³ï¼Œå·¥ä½œè®¤çœŸç»†è‡´ï¼Œæœ‰è´£ä»»æ„Ÿï¼Œå›¢é˜Ÿåä½œæ„è¯†å¼ºã€‚'</span>
<span class="n">i</span> <span class="o">=</span> <span class="s">'å†œä¸š'</span>
<span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">content</span><span class="p">).</span><span class="n">span</span><span class="p">()</span>
<span class="c1"># output 
</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="pandas-ä¸€è¡Œåˆ‡åˆ†å˜å¤šè¡Œ">pandas ä¸€è¡Œåˆ‡åˆ†å˜å¤šè¡Œ</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_jd_content_split</span> <span class="o">=</span> <span class="n">df_jd_content</span><span class="p">[</span><span class="s">'detail'</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'&lt;br&gt;|ã€‚|ï¼›\dã€'</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">stack</span><span class="p">()</span>
<span class="n">df_jd_content_split</span> <span class="o">=</span> <span class="n">df_jd_content_split</span><span class="p">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">rename</span><span class="p">(</span><span class="s">'detail'</span><span class="p">)</span>
<span class="n">df_jd_content_split</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df_jd_content_split</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="pyhanlp-ä¾å­˜å¥æ³•åˆ†æç»“æœè§£æ">pyhanlp ä¾å­˜å¥æ³•åˆ†æç»“æœè§£æ</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">In</span> <span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="k">print</span><span class="p">(</span><span class="n">HanLP</span><span class="p">.</span><span class="n">parseDependency</span><span class="p">(</span><span class="s">'å®½å¸¦å¾®æ³¢æ”¶å‘ç”µè·¯è®¾è®¡'</span><span class="p">))</span>                                                                                       
<span class="mi">1</span>       <span class="n">å®½å¸¦å¾®æ³¢</span>        <span class="n">å®½å¸¦å¾®æ³¢</span>        <span class="n">nh</span>      <span class="n">nr</span>      <span class="n">_</span>       <span class="mi">2</span>       <span class="n">ä¸»è°“å…³ç³»</span>        <span class="n">_</span>       <span class="n">_</span>
<span class="mi">2</span>       <span class="n">æ”¶å‘</span>    <span class="n">æ”¶å‘</span>    <span class="n">v</span>       <span class="n">v</span>       <span class="n">_</span>       <span class="mi">0</span>       <span class="n">æ ¸å¿ƒå…³ç³»</span>        <span class="n">_</span>       <span class="n">_</span>
<span class="mi">3</span>       <span class="n">ç”µè·¯è®¾è®¡</span>        <span class="n">ç”µè·¯è®¾è®¡</span>        <span class="n">nz</span>      <span class="n">nz</span>      <span class="n">_</span>       <span class="mi">2</span>       <span class="n">åŠ¨å®¾å…³ç³»</span>        <span class="n">_</span>       <span class="n">_</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">62</span><span class="p">]:</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">HanLP</span><span class="p">.</span><span class="n">parseDependency</span><span class="p">(</span><span class="s">'å®½å¸¦å¾®æ³¢æ”¶å‘ç”µè·¯è®¾è®¡'</span><span class="p">):</span> 
    <span class="p">...:</span>     <span class="k">print</span><span class="p">(</span><span class="n">word</span><span class="p">.</span><span class="n">ID</span><span class="p">)</span> 
    <span class="p">...:</span>     <span class="k">print</span><span class="p">(</span><span class="n">word</span><span class="p">.</span><span class="n">LEMMA</span><span class="p">)</span> 
    <span class="p">...:</span>                                                                                                                                            
<span class="mi">1</span>
<span class="n">å®½å¸¦å¾®æ³¢</span>
<span class="mi">2</span>
<span class="n">æ”¶å‘</span>
<span class="mi">3</span>
<span class="n">ç”µè·¯è®¾è®¡</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * ID  å½“å‰è¯åœ¨å¥å­ä¸­çš„åºå·ï¼Œï¼‘å¼€å§‹.
 */</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="no">ID</span><span class="o">;</span>
<span class="cm">/**
 * å½“å‰è¯è¯­ï¼ˆæˆ–æ ‡ç‚¹ï¼‰çš„åŸå‹æˆ–è¯å¹²ï¼Œåœ¨ä¸­æ–‡ä¸­ï¼Œæ­¤åˆ—ä¸FORMç›¸åŒ
 */</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="no">LEMMA</span><span class="o">;</span>
<span class="cm">/**
 * å½“å‰è¯è¯­çš„è¯æ€§ï¼ˆç²—ç²’åº¦ï¼‰
 */</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="no">CPOSTAG</span><span class="o">;</span>
<span class="cm">/**
 * å½“å‰è¯è¯­çš„è¯æ€§ï¼ˆç»†ç²’åº¦ï¼‰
 */</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="no">POSTAG</span><span class="o">;</span>
<span class="cm">/**
 * å½“å‰è¯è¯­çš„ä¸­å¿ƒè¯
 */</span>
<span class="kd">public</span> <span class="nc">CoNLLWord</span> <span class="no">HEAD</span><span class="o">;</span>
<span class="cm">/**
 * å½“å‰è¯è¯­ä¸ä¸­å¿ƒè¯çš„ä¾å­˜å…³ç³»
 */</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="no">DEPREL</span><span class="o">;</span>

<span class="cm">/**
 * ç­‰æ•ˆå­—ç¬¦ä¸²
 */</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="no">NAME</span><span class="o">;</span>

<span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="no">ID</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'\t'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="no">LEMMA</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'\t'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="no">LEMMA</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'\t'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="no">CPOSTAG</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'\t'</span><span class="o">)</span> <span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="no">POSTAG</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'\t'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'_'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'\t'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="no">HEAD</span><span class="o">.</span><span class="na">ID</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'\t'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="no">DEPREL</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'\t'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'_'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'\t'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'_'</span><span class="o">);</span>

<span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="no">ID</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'\t'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="no">LEMMA</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'\t'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="no">LEMMA</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'\t'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="no">CPOSTAG</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'\t'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="no">POSTAG</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'\t'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'_'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'\t'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="no">HEAD</span><span class="o">.</span><span class="na">ID</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'\t'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="no">DEPREL</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'\t'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'_'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'\t'</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">'_'</span><span class="o">);</span>
</code></pre></div></div>

<h2 id="pandas-æŸåˆ—-æŒ‰æŸä¸ªå€¼åˆ é™¤">pandas æŸåˆ— æŒ‰æŸä¸ªå€¼åˆ é™¤</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># contentï¼šåˆ—åï¼Œ''ï¼šå¯ä»¥æ¢æˆå…¶ä»–çš„ï¼ŒNoneç­‰
</span><span class="n">df_search_space</span> <span class="o">=</span> <span class="n">df_search_space</span><span class="p">[</span><span class="o">~</span><span class="n">df_search_space</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="n">isin</span><span class="p">([</span><span class="s">''</span><span class="p">])]</span>
</code></pre></div></div>

<h2 id="python-åˆ¤æ–­å­—ç¬¦ä¸²å¼‚å¸¸">python åˆ¤æ–­å­—ç¬¦ä¸²å¼‚å¸¸</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">judge</span><span class="p">(</span><span class="n">hostip</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">hostip</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">hostip</span> <span class="ow">or</span> <span class="n">hostip</span> <span class="o">==</span> <span class="s">''</span> <span class="ow">or</span> <span class="n">hostip</span> <span class="o">==</span> <span class="s">'null'</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
</code></pre></div></div>

<h2 id="sql-group-by-æ¯ä¸ªç±»éšæœºæŠ½å–">sql group by æ¯ä¸ªç±»éšæœºæŠ½å–</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span>
	<span class="o">*</span>
<span class="k">from</span>
  <span class="p">(</span>
    <span class="k">select</span>
      <span class="o">*</span><span class="p">,</span>
      <span class="n">row_number</span><span class="p">()</span> <span class="n">over</span><span class="p">(</span>
        <span class="n">partition</span> <span class="k">by</span> <span class="n">job_init_title</span>
        <span class="k">order</span> <span class="k">by</span>
          <span class="n">rand</span><span class="p">()</span>
      <span class="p">)</span> <span class="k">as</span> <span class="n">rn</span>
    <span class="k">from</span>
      <span class="n">dw_chihiro_algo_d_job_feature</span>
    <span class="k">where</span>
      <span class="n">p_date</span> <span class="o">==</span> <span class="s1">'20210419'</span>
  <span class="p">)</span> <span class="n">a</span>
<span class="k">where</span>
  <span class="n">a</span><span class="p">.</span><span class="n">rn</span> <span class="o">&lt;=</span> <span class="mi">500</span>
  
<span class="c1">-- https://blog.csdn.net/qq_29232943/article/details/104635492</span>
</code></pre></div></div>

<h2 id="pandas-å¢åŠ ä¸¤åˆ—">pandas å¢åŠ ä¸¤åˆ—</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">cut_match</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span> 
    <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">jieba</span><span class="p">.</span><span class="n">cut</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">job_title</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">x</span><span class="p">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">))</span>
<span class="n">df_match</span><span class="p">[[</span><span class="s">'contain'</span><span class="p">,</span><span class="s">'total'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df_match</span><span class="p">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">cut_match</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">result_type</span><span class="o">=</span><span class="s">'expand'</span><span class="p">)</span>
<span class="c1"># result_type='expand' å¿…é¡»åŠ 
</span></code></pre></div></div>

<h2 id="pandas-è½¬-dictè¡Œ">pandas è½¬ dictã€è¡Œã€‘</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">"å§“å"</span><span class="p">:</span> <span class="p">[</span><span class="s">"å¤æ˜åœ°è§‰"</span><span class="p">],</span>
                   <span class="s">"æ°´æœ"</span><span class="p">:</span> <span class="p">[</span><span class="s">"è‰è“"</span><span class="p">],</span>
                   <span class="s">"æ˜ŸæœŸä¸€"</span><span class="p">:</span> <span class="p">[</span><span class="s">"70æ–¤"</span><span class="p">],</span>
                   <span class="s">"æ˜ŸæœŸäºŒ"</span><span class="p">:</span> <span class="p">[</span><span class="s">"72æ–¤"</span><span class="p">],</span>
                   <span class="s">"æ˜ŸæœŸä¸‰"</span><span class="p">:</span> <span class="p">[</span><span class="s">"60æ–¤"</span><span class="p">],</span>
                   <span class="p">})</span>
<span class="n">out</span><span class="p">:</span>
<span class="n">å§“å</span>	<span class="n">æ°´æœ</span>	<span class="n">æ˜ŸæœŸä¸€</span>	<span class="n">æ˜ŸæœŸäºŒ</span>	<span class="n">æ˜ŸæœŸä¸‰</span>
<span class="mi">0</span>	<span class="n">å¤æ˜åœ°è§‰</span>	<span class="n">è‰è“</span>	<span class="mi">70</span><span class="n">æ–¤</span>	<span class="mi">72</span><span class="n">æ–¤</span>	<span class="mi">60</span><span class="n">æ–¤</span>

<span class="n">pd</span><span class="p">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">value_vars</span><span class="o">=</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">out</span><span class="p">:</span>
    <span class="n">variable</span>	<span class="n">value</span>
<span class="mi">0</span>	<span class="n">å§“å</span>	<span class="n">å¤æ˜åœ°è§‰</span>
<span class="mi">1</span>	<span class="n">æ°´æœ</span>	<span class="n">è‰è“</span>
<span class="mi">2</span>	<span class="n">æ˜ŸæœŸä¸€</span>	<span class="mi">70</span><span class="n">æ–¤</span>
<span class="mi">3</span>	<span class="n">æ˜ŸæœŸäºŒ</span>	<span class="mi">72</span><span class="n">æ–¤</span>
<span class="mi">4</span>	<span class="n">æ˜ŸæœŸä¸‰</span>	<span class="mi">60</span><span class="n">æ–¤</span>

<span class="n">pd</span><span class="p">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">value_vars</span><span class="o">=</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">).</span><span class="n">set_index</span><span class="p">(</span><span class="s">'variable'</span><span class="p">)[</span><span class="s">'value'</span><span class="p">].</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">out</span><span class="p">:</span>
    <span class="p">{</span><span class="s">'å§“å'</span><span class="p">:</span> <span class="s">'å¤æ˜åœ°è§‰'</span><span class="p">,</span> <span class="s">'æ°´æœ'</span><span class="p">:</span> <span class="s">'è‰è“'</span><span class="p">,</span> <span class="s">'æ˜ŸæœŸä¸€'</span><span class="p">:</span> <span class="s">'70æ–¤'</span><span class="p">,</span> <span class="s">'æ˜ŸæœŸäºŒ'</span><span class="p">:</span> <span class="s">'72æ–¤'</span><span class="p">,</span> <span class="s">'æ˜ŸæœŸä¸‰'</span><span class="p">:</span> <span class="s">'60æ–¤'</span><span class="p">}</span>
</code></pre></div></div>

<h2 id="pbæ¨¡å‹æ‰“å°è¯¦ç»†ä¿¡æ¯">pbæ¨¡å‹æ‰“å°è¯¦ç»†ä¿¡æ¯</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">saved_model_cli</span> <span class="n">show</span> <span class="o">--</span><span class="nb">dir</span> <span class="n">saved_model</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span> <span class="o">--</span><span class="nb">all</span>
</code></pre></div></div>

<h2 id="pandas-æŒ‰æŸåˆ—å»é‡å¹¶æŒ‰å¦å¤–ä¸€åˆ—æœ€å¤§å€¼ä¿ç•™">pandas æŒ‰æŸåˆ—å»é‡ï¼Œå¹¶æŒ‰å¦å¤–ä¸€åˆ—æœ€å¤§å€¼ä¿ç•™</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_loginip</span> <span class="o">=</span> <span class="n">df_loginip</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'actor_id'</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">.</span><span class="n">p_date</span><span class="p">.</span><span class="n">idxmax</span><span class="p">()])</span> <span class="c1"># æŒ‰ç…§actor_idå»é‡,å¹¶æŒ‰ç…§p_dateæœ€å¤§çš„ä¿ç•™
</span></code></pre></div></div>

<h2 id="plt-ç”»å›¾">plt ç”»å›¾</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">l1</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="s">'r'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s">'abnormal'</span><span class="p">)</span>
<span class="n">l2</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">p0</span><span class="p">,</span><span class="s">'b'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s">'normal'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'precision'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p1</span> <span class="p">,</span><span class="n">p0</span><span class="p">):</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s">'left'</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s">'bottom'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s">'left'</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s">'top'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s">'upper left'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">)</span><span class="c1">#è°ƒæ•´å­å›¾é—´è·
</span><span class="n">l3</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">r1</span><span class="p">,</span><span class="s">'r'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s">'abnormal'</span><span class="p">)</span>
<span class="n">l4</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">r0</span><span class="p">,</span><span class="s">'b'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s">'normal'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'recall'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r1</span> <span class="p">,</span><span class="n">r0</span><span class="p">):</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s">'left'</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s">'bottom'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s">'left'</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s">'top'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s">'upper left'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">)</span><span class="c1">#è°ƒæ•´å­å›¾é—´è·
</span><span class="n">l5</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">f1</span><span class="p">,</span><span class="s">'r'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s">'abnormal'</span><span class="p">)</span>
<span class="n">l6</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">f0</span><span class="p">,</span><span class="s">'b'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s">'normal'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'f1-score'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f1</span> <span class="p">,</span><span class="n">f0</span><span class="p">):</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s">'left'</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s">'bottom'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s">'left'</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s">'top'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s">'upper left'</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'model/eval.png'</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span> <span class="mi">800</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><a href="https://imgtu.com/i/hjKWJf"><img src="https://z3.ax1x.com/2021/09/10/hjKWJf.png" alt="hjKWJf.png" /></a></p>

<h2 id="nerå®ä½“è§£æä»£ç ç®€çº¦ç‰ˆ">NERå®ä½“è§£æä»£ç ï¼ˆç®€çº¦ç‰ˆï¼‰</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ä»é¢„æµ‹çš„æ ‡ç­¾åˆ—è¡¨ä¸­è·å–å®ä½“
</span><span class="k">def</span> <span class="nf">get_entity</span><span class="p">(</span><span class="n">sent</span><span class="p">,</span> <span class="n">tags_list</span><span class="p">):</span>

    <span class="n">entity_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">char</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sent</span><span class="p">,</span> <span class="n">tags_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">'B-'</span> <span class="ow">in</span> <span class="n">tag</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">char</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">entity_type</span> <span class="o">=</span> <span class="n">tag</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'-'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sent</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">tags_list</span><span class="p">))</span> <span class="ow">and</span> <span class="s">'I-%s'</span> <span class="o">%</span> <span class="n">entity_type</span> <span class="ow">in</span> <span class="n">tags_list</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">entity</span> <span class="o">+=</span> <span class="n">sent</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">entity_dict</span><span class="p">[</span><span class="n">entity_type</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>

        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">entity_dict</span><span class="p">)</span>
<span class="c1"># åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/weixin_42691585/article/details/107617304
</span></code></pre></div></div>

:ET